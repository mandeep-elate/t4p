System.register(["../../common/style-legacy.DAJgtavs.js","./style.scss-legacy.CHq7dT4S.js"],function(e,t){"use strict";return{setters:[null,null],execute:function(){!function(e,t,a){const{__:o}=e.wp.i18n;a(function(){a(".adt-manage-feeds-table-row").each(function(){const e=a(this),t=e.hasClass("processing"),o=e.find(".adt-manage-feeds-action-refresh"),s=e.find(".adt-manage-feeds-action-cancel");t?(o.addClass("hidden"),s.removeClass("hidden")):(o.removeClass("hidden"),s.addClass("hidden"))}),a(".adt-manage-feeds-bulk-actions-select").prop("disabled",!0);let t=!1,s=null,d=null;function n(s,d,c){console.log(`Generating batch for feed ${s}, offset: ${d}, batch size: ${c}`);const i=a(`.adt-manage-feeds-table-row[data-feed-id="${s}"]`);if(i.length){const e=i.find(".adt-manage-feeds-table-row-status-text"),t=i.find(".adt-manage-feeds-table-row-status-dot");i.addClass("processing"),e.text().includes(o("Processing","woo-product-feed-pro"))||e.text(o("Processing","woo-product-feed-pro")+" (0%)"),t.attr("data-status","processing")}a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_pfp_generate_product_feed",nonce:e.adtObj.adtNonce,feed_id:s,offset:d,batch_size:c},success:function(e){e.success&&"processing"===e.data.status?(t?console.log("Feed status polling already active, continuing with batch processing"):(console.log("Starting feed status polling for batch processing"),r([s])),n(e.data.feed_id,e.data.offset,e.data.batch_size)):e.success&&console.log(`Feed ${s} batch processing completed`)},error:function(e,t,a){console.error(`Error generating feed batch: ${a}`)}})}function r(e){i(),t=!0,l(e),d=window.setInterval(()=>{if(t){const e=c();e.length>0?l(e):(console.log("No more processing feeds found, stopping poll"),i())}else i()},1e3)}function c(){const e=[];return a(".adt-manage-feeds-table-row").each(function(){const t=a(this),o=t.data("feed-id"),s=t.hasClass("processing"),d=t.find(".adt-manage-feeds-table-row-status-dot"),n="processing"===d.attr("data-status"),r=t.find(".adt-manage-feeds-table-row-status-text").text().toLowerCase().includes("processing");if((s||n||r)&&o){e.push(o),s||t.addClass("processing"),n||d.attr("data-status","processing");const a=t.find(".adt-manage-feeds-action-refresh"),r=t.find(".adt-manage-feeds-action-cancel");a.hasClass("hidden")||a.addClass("hidden"),r.hasClass("hidden")&&r.removeClass("hidden")}}),console.log("Found processing feed IDs:",e),e}function i(){console.log("Stopping feed status polling"),null!==d&&(console.log("Clearing interval ID:",d),window.clearInterval(d),d=null),null!==s&&(console.log("Aborting active XHR request"),s.abort(),s=null),t=!1,console.log("Poll stopped, isRefreshRunning =",t)}function l(t){null===s&&(0!==t.length?(console.log("Checking status for feed IDs:",t),s=a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_get_feed_processing_status",nonce:e.adtObj.adtNonce,feed_ids:t},success:function(e){s=null,e.success&&e.data&&e.data.length>0?e.data.forEach(e=>{const t=a(`.adt-manage-feeds-table-row[data-feed-id="${e.feed_id}"]`);if(t.length){const s=t.find(".adt-manage-feeds-table-row-status-text"),d=t.find(".adt-manage-feeds-table-row-status-dot"),n=t.find(".adt-manage-feeds-action-refresh"),r=t.find(".adt-manage-feeds-action-cancel"),c=t.find(".adt-manage-feeds-table-row-last-updated div");c.length&&c.text(e.last_updated);const i=t.find(".adt-manage-feeds-table-row-url div");i.length&&e.feed_url_html&&(i.html(e.feed_url_html),i.find(".adt-manage-feeds-table-row-url-copy-button").on("click",function(){const e=a(this).closest(".adt-manage-feeds-table-row-url").find("input");e.length&&f(e.val(),a(this))})),"processing"===e.status&&e.proc_perc<100?(t.addClass("processing"),s.text(o("Processing","woo-product-feed-pro")+` (${e.proc_perc}%)`),d.attr("data-status","processing"),n.hasClass("hidden")||n.addClass("hidden"),r.hasClass("hidden")&&r.removeClass("hidden"),console.log(`Feed ${e.feed_id} still processing at ${e.proc_perc}%`)):(t.removeClass("processing"),s.text(e.status),d.attr("data-status",e.status.toLowerCase()),n.hasClass("hidden")&&n.removeClass("hidden"),r.hasClass("hidden")||r.addClass("hidden"),console.log(`Feed ${e.feed_id} completed with status: ${e.status}`))}}):console.log("No valid data in response or empty response")},error:function(e,t,a){s=null,console.error("Error checking feed status:",a)}})):i())}function f(e,t){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(e).then(()=>{p(t)}).catch(a=>{console.error("Failed to copy text: ",a),u(e,t)}):u(e,t)}function u(e,t){try{const a=document.createElement("input");a.value=e,document.body.appendChild(a),a.select(),a.setSelectionRange(0,99999);const o=document.execCommand("copy");document.body.removeChild(a),o?p(t):console.error("Failed to copy text with execCommand")}catch(a){console.error("Failed to copy text with fallback method: ",a)}}function p(e){const t=e.find(".adt-tooltip-content"),a=t.text();t.text(o("Copied!","woo-product-feed-pro")),setTimeout(()=>{t.text(a)},2e3)}a(".adt-manage-feeds-status-toggle").on("click",function(){const t=a(this),s=t.closest(".adt-manage-feeds-table-row"),d=s.data("feed-id"),n=t.data("current-status").toLowerCase(),r=s.find(".adt-manage-feeds-table-row-status-dot");if("ready"===n||"inactive"===n){const c="inactive"===n,i=o(c?"Are you sure you want to activate this feed?":"Are you sure you want to deactivate this feed?","woo-product-feed-pro");confirm(i)&&a.ajax({url:e.ajaxurl,type:"POST",data:{action:c?"adt_feed_action_activate":"adt_feed_action_deactivate",id:d,nonce:e.adtObj.adtNonce},success:function(e){if(e.success){const e=c?"ready":"inactive",a=o(c?"Ready":"Inactive","woo-product-feed-pro");t.text(a),t.data("current-status",e),t.attr("data-current-status",e),s.attr("data-post-status",c?"publish":"draft"),r.attr("data-status",e),c?s.find(".adt-manage-feeds-table-row-actions-refresh-cancel").show():s.find(".adt-manage-feeds-table-row-actions-refresh-cancel").hide()}else alert(o("Error: ","woo-product-feed-pro")+(e.data?.message||o("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}})}}),a(".adt-manage-feeds-table-header-checkbox input").on("change",function(){const e=a(this).prop("checked");a(".adt-manage-feeds-table-row-checkbox input").prop("checked",e),a(".adt-manage-feeds-bulk-actions-select").prop("disabled",!e)}),a(".adt-manage-feeds-table-row-checkbox input").on("change",function(){const e=a(".adt-manage-feeds-table-row-checkbox input:checked").length>0;a(".adt-manage-feeds-bulk-actions-select").prop("disabled",!e),function(){const e=a(".adt-manage-feeds-table-row-checkbox input").length,t=a(".adt-manage-feeds-table-row-checkbox input:checked").length,o=a(".adt-manage-feeds-table-header-checkbox input");0===t?(o.prop("checked",!1),o.prop("indeterminate",!1)):t===e?(o.prop("checked",!0),o.prop("indeterminate",!1)):(o.prop("checked",!1),o.prop("indeterminate",!0))}()}),a(".adt-manage-feeds-pagination-show-select").on("change",function(){const e=a(this).val();if(e!==a(this).data("current-page-size")){const t=new URL(window.location.href);t.searchParams.set("page_num","1"),t.searchParams.set("per_page",e),window.location.href=t.toString()}}),a(".adt-manage-feeds-table-row-url-copy-button").on("click",function(){const e=a(this).closest(".adt-manage-feeds-table-row-url").find("input");e.length&&f(e.val(),a(this))}),a(".adt-manage-feeds-action-duplicate").on("click",function(t){t.preventDefault();const s=a(this).closest(".adt-manage-feeds-table-row").data("feed-id");s&&confirm(o("Are you sure you want to duplicate this feed?","woo-product-feed-pro"))&&a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_clone",id:s,nonce:e.adtObj.adtNonce},success:function(e){e.success?window.location.reload():alert(o("Error: ","woo-product-feed-pro")+(e.data.message||o("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}})}),a(".adt-manage-feeds-action-refresh, .adt-manage-feeds-action-cancel").on("click",function(t){t.preventDefault();const s=a(this).closest(".adt-manage-feeds-table-row"),d=s.data("feed-id"),c=s.find(".adt-manage-feeds-table-row-status-text"),i=s.find(".adt-manage-feeds-table-row-status-dot"),l=s.find(".adt-manage-feeds-action-refresh"),f=s.find(".adt-manage-feeds-action-cancel"),u=a(this).hasClass("adt-manage-feeds-action-cancel");d&&(u?confirm(o("Are you sure you want to cancel processing the feed?","woo-product-feed-pro"))&&a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_cancel",id:d,nonce:e.adtObj.adtNonce},success:function(e){e.success?(s.removeClass("processing"),c.text(o("Stopped","woo-product-feed-pro")),i.attr("data-status","ready"),l.removeClass("hidden"),f.addClass("hidden")):alert(o("Error: ","woo-product-feed-pro")+(e.data?.message||o("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}}):confirm(o("Are you sure you want to refresh this feed now?","woo-product-feed-pro"))&&(s.addClass("processing"),c.text(o("Processing","woo-product-feed-pro")+" (0%)"),i.attr("data-status","processing"),l.addClass("hidden"),f.removeClass("hidden"),a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_refresh",id:d,nonce:e.adtObj.adtNonce},success:function(e){e.success?(console.log("Starting feed status polling for single feed refresh"),r([d]),e.data&&"ajax"===e.data.executed_from&&n(e.data.feed_id,e.data.offset||0,e.data.batch_size||0)):(alert(o("Error: ","woo-product-feed-pro")+(e.data?.message||o("An unknown error occurred.","woo-product-feed-pro"))),s.removeClass("processing"),c.text(o("Ready","woo-product-feed-pro")),i.attr("data-status","ready"),l.removeClass("hidden"),f.addClass("hidden"))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro")),s.removeClass("processing"),c.text(o("Ready","woo-product-feed-pro")),i.attr("data-status","ready"),l.removeClass("hidden"),f.addClass("hidden")}})))}),function(){const t=c();t.length>0?(console.log("Found in-progress feeds on page load:",t),a(".adt-manage-feeds-table-row.processing").each(function(){const e=a(this).find(".adt-manage-feeds-action-refresh"),t=a(this).find(".adt-manage-feeds-action-cancel");e.hasClass("hidden")||e.addClass("hidden"),t.hasClass("hidden")&&t.removeClass("hidden")}),console.log("Starting initial feed status polling"),r(t),console.log("Checking for feeds that need batch processing"),a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_get_feed_processing_status",nonce:e.adtObj.adtNonce,feed_ids:t},success:function(e){e.success&&e.data&&e.data.length>0?e.data.forEach(e=>{"processing"===e.status&&"ajax"===e.executed_from&&(console.log(`Resuming batch generation for feed ID ${e.feed_id}`),n(e.feed_id,e.offset,e.batch_size))}):console.log("No feeds need batch processing or no valid response data")},error:function(e,t,a){console.error("Error checking feed details:",a)}})):console.log("No in-progress feeds found on page load")}(),a(".adt-manage-feeds-action-delete").on("click",function(t){t.preventDefault();const s=a(this).closest(".adt-manage-feeds-table-row").data("feed-id");s&&confirm(o("Are you sure you want to delete this feed? This action cannot be undone.","woo-product-feed-pro"))&&a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_feed_action_delete",id:s,nonce:e.adtObj.adtNonce},success:function(e){e.success?window.location.reload():alert(o("Error: ","woo-product-feed-pro")+(e.data.message||o("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro"))}})}),a(".adt-manage-feeds-bulk-actions-select").on("change",function(){const s=a(this).val();s&&(!function(s,d){let l;if("cancel"===s){const e=[];if(a(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const t=a(this).closest(".adt-manage-feeds-table-row"),o=t.data("feed-id"),s=t.hasClass("processing")||"processing"===t.find(".adt-manage-feeds-table-row-status-dot").attr("data-status");o&&s&&e.push(o)}),0===(d=e.length))return void alert(o("No processing feeds selected. The cancel action only applies to feeds that are currently processing.","woo-product-feed-pro"));l=o(`Are you sure you want to cancel processing ${d} feed(s)?`,"woo-product-feed-pro")}else if("refresh"===s){const e=[];if(a(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const t=a(this).closest(".adt-manage-feeds-table-row"),o=t.data("feed-id"),s="publish"===t.data("post-status");o&&s&&e.push(o)}),0===(d=e.length))return void alert(o("No active feeds selected. The refresh action only applies to feeds that are currently active.","woo-product-feed-pro"));l=o(`Are you sure you want to refresh ${d} feed(s)?`,"woo-product-feed-pro")}else switch(s){case"activate":l=o(`Are you sure you want to activate ${d} feed(s)?`,"woo-product-feed-pro");break;case"deactivate":l=o(`Are you sure you want to deactivate ${d} feed(s)?`,"woo-product-feed-pro");break;case"duplicate":l=o(`Are you sure you want to duplicate ${d} feed(s)?`,"woo-product-feed-pro");break;case"delete":l=o(`Are you sure you want to delete ${d} feed(s)? This action cannot be undone.`,"woo-product-feed-pro");break;default:return}confirm(l)&&function(s){let d=[];a(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const e=a(this).closest(".adt-manage-feeds-table-row").data("feed-id");e&&d.push(e)}),"cancel"!==s||(d=d.filter(e=>{const t=a(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`);return t.hasClass("processing")||"processing"===t.find(".adt-manage-feeds-table-row-status-dot").attr("data-status")}),0!==d.length)?"refresh"!==s||(d=d.filter(e=>"publish"===a(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`).data("post-status")),0!==d.length)?d.length>0&&(console.log(`Processing ${s} for feed IDs:`,d),"refresh"===s&&d.forEach(e=>{const t=a(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),s=t.find(".adt-manage-feeds-table-row-status-text"),d=t.find(".adt-manage-feeds-table-row-status-dot"),n=t.find(".adt-manage-feeds-action-refresh"),r=t.find(".adt-manage-feeds-action-cancel");t.addClass("processing"),s.text(o("Processing","woo-product-feed-pro")+" (0%)"),d.attr("data-status","processing"),n.addClass("hidden"),r.removeClass("hidden")}),"cancel"===s&&d.forEach(e=>{a(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`).find(".adt-manage-feeds-table-row-status-text").text(o("Cancelling...","woo-product-feed-pro"))}),a.ajax({url:e.ajaxurl,type:"POST",data:{action:"adt_process_bulk_feed_actions",feed_ids:d,bulk_action:s,nonce:e.adtObj.adtNonce},success:function(e){if(e.success)if("refresh"===s)console.log("Starting feed status polling for refresh action"),r(d),e.data&&e.data.feeds&&e.data.feeds.length>0?(console.log("Received feeds for processing:",e.data.feeds),e.data.feeds.forEach(e=>{"ajax"===e.executed_from?(console.log(`Starting batch generation for feed ID ${e.feed_id}`),n(e.feed_id,e.offset||0,e.batch_size||0)):console.log(`Feed ID ${e.feed_id} will be processed via cron`)})):console.warn("No feeds data returned in the response, continuing with status polling only");else if("cancel"===s){if(d.forEach(e=>{const t=a(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),s=t.find(".adt-manage-feeds-table-row-status-text"),d=t.find(".adt-manage-feeds-table-row-status-dot"),n=t.find(".adt-manage-feeds-action-refresh"),r=t.find(".adt-manage-feeds-action-cancel");t.removeClass("processing"),s.text(o("Stopped","woo-product-feed-pro")),d.attr("data-status","stopped"),n.removeClass("hidden"),r.addClass("hidden")}),t){const e=c();0===e.length?(console.log("No more feeds are processing after cancel action, stopping poll"),i()):console.log(`${e.length} feeds still processing after cancel action, continuing poll`)}}else if(e.data&&e.data.pagination){const t=new URL(window.location.href),a=e.data.pagination;t.searchParams.set("page_num",a.current_page.toString()),t.searchParams.set("per_page",a.per_page.toString()),window.location.href=t.toString()}else window.location.href=window.location.href;else alert(o("Error: ","woo-product-feed-pro")+(e.data?.message||o("An unknown error occurred.","woo-product-feed-pro"))),"refresh"!==s&&"cancel"!==s||d.forEach(e=>{const t=a(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),d=t.find(".adt-manage-feeds-table-row-status-text"),n=t.find(".adt-manage-feeds-table-row-status-dot"),r=t.find(".adt-manage-feeds-action-refresh"),c=t.find(".adt-manage-feeds-action-cancel");"refresh"===s&&(t.removeClass("processing"),d.text(o("Ready","woo-product-feed-pro")),n.attr("data-status","ready"),r.removeClass("hidden"),c.addClass("hidden"))})},error:function(){alert(o("A network error occurred. Please try again.","woo-product-feed-pro")),"refresh"!==s&&"cancel"!==s||d.forEach(e=>{const t=a(`.adt-manage-feeds-table-row[data-feed-id="${e}"]`),d=t.find(".adt-manage-feeds-table-row-status-text"),n=t.find(".adt-manage-feeds-table-row-status-dot"),r=t.find(".adt-manage-feeds-action-refresh"),c=t.find(".adt-manage-feeds-action-cancel");"refresh"===s&&(t.removeClass("processing"),d.text(o("Ready","woo-product-feed-pro")),n.attr("data-status","ready"),r.removeClass("hidden"),c.addClass("hidden"))})}})):alert(o("No active feeds selected. The refresh action only applies to feeds that are currently active.","woo-product-feed-pro")):alert(o("No processing feeds selected. The cancel action only applies to feeds that are currently processing.","woo-product-feed-pro"))}(s)}(s,a(".adt-manage-feeds-table-row-checkbox input:checked").length),a(this).val(""))})})}(window,document,jQuery)}}});
