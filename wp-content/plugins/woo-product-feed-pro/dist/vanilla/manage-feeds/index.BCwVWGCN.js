/* empty css                         *//* empty css                   */function F(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(f,I,o){const{__:d}=f.wp.i18n;o(function(){o(".adt-manage-feeds-table-row").each(function(){const a=o(this),t=a.hasClass("processing"),e=a.find(".adt-manage-feeds-action-refresh"),s=a.find(".adt-manage-feeds-action-cancel");t?(e.addClass("hidden"),s.removeClass("hidden")):(e.removeClass("hidden"),s.addClass("hidden"))}),o(".adt-manage-feeds-bulk-actions-select").prop("disabled",!0);let p=!1,g=null,h=null;o(".adt-manage-feeds-status-toggle").on("click",function(){const a=o(this),t=a.closest(".adt-manage-feeds-table-row"),e=t.data("feed-id"),s=a.data("current-status").toLowerCase(),n=t.find(".adt-manage-feeds-table-row-status-dot");if(s==="ready"||s==="inactive"){const r=s==="inactive",c=d(r?"Are you sure you want to activate this feed?":"Are you sure you want to deactivate this feed?","woo-product-feed-pro");confirm(c)&&o.ajax({url:f.ajaxurl,type:"POST",data:{action:r?"adt_feed_action_activate":"adt_feed_action_deactivate",id:e,nonce:f.adtObj.adtNonce},success:function(u){var i;if(u.success){const l=r?"ready":"inactive",x=d(r?"Ready":"Inactive","woo-product-feed-pro");a.text(x),a.data("current-status",l),a.attr("data-current-status",l),t.attr("data-post-status",r?"publish":"draft"),n.attr("data-status",l),r?t.find(".adt-manage-feeds-table-row-actions-refresh-cancel").show():t.find(".adt-manage-feeds-table-row-actions-refresh-cancel").hide()}else alert(d("Error: ","woo-product-feed-pro")+(((i=u.data)==null?void 0:i.message)||d("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(d("A network error occurred. Please try again.","woo-product-feed-pro"))}})}}),o(".adt-manage-feeds-table-header-checkbox input").on("change",function(){const a=o(this).prop("checked");o(".adt-manage-feeds-table-row-checkbox input").prop("checked",a),o(".adt-manage-feeds-bulk-actions-select").prop("disabled",!a)}),o(".adt-manage-feeds-table-row-checkbox input").on("change",function(){const a=o(".adt-manage-feeds-table-row-checkbox input:checked").length>0;o(".adt-manage-feeds-bulk-actions-select").prop("disabled",!a),S()}),o(".adt-manage-feeds-pagination-show-select").on("change",function(){const a=o(this).val(),t=o(this).data("current-page-size");if(a!==t){const e=new URL(window.location.href);e.searchParams.set("page_num","1"),e.searchParams.set("per_page",a),window.location.href=e.toString()}}),o(".adt-manage-feeds-table-row-url-copy-button").on("click",function(){const a=o(this).closest(".adt-manage-feeds-table-row-url").find("input");if(a.length){const t=a.val();_(t,o(this))}}),o(".adt-manage-feeds-action-duplicate").on("click",function(a){a.preventDefault();const t=o(this).closest(".adt-manage-feeds-table-row").data("feed-id");t&&confirm(d("Are you sure you want to duplicate this feed?","woo-product-feed-pro"))&&o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_feed_action_clone",id:t,nonce:f.adtObj.adtNonce},success:function(e){e.success?window.location.reload():alert(d("Error: ","woo-product-feed-pro")+(e.data.message||d("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(d("A network error occurred. Please try again.","woo-product-feed-pro"))}})}),o(".adt-manage-feeds-action-refresh, .adt-manage-feeds-action-cancel").on("click",function(a){a.preventDefault();const t=o(this).closest(".adt-manage-feeds-table-row"),e=t.data("feed-id"),s=t.find(".adt-manage-feeds-table-row-status-text"),n=t.find(".adt-manage-feeds-table-row-status-dot"),r=t.find(".adt-manage-feeds-action-refresh"),c=t.find(".adt-manage-feeds-action-cancel"),u=o(this).hasClass("adt-manage-feeds-action-cancel");e&&(u?confirm(d("Are you sure you want to cancel processing the feed?","woo-product-feed-pro"))&&o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_feed_action_cancel",id:e,nonce:f.adtObj.adtNonce},success:function(i){var l;i.success?(t.removeClass("processing"),s.text(d("Stopped","woo-product-feed-pro")),n.attr("data-status","ready"),r.removeClass("hidden"),c.addClass("hidden")):alert(d("Error: ","woo-product-feed-pro")+(((l=i.data)==null?void 0:l.message)||d("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(d("A network error occurred. Please try again.","woo-product-feed-pro"))}}):confirm(d("Are you sure you want to refresh this feed now?","woo-product-feed-pro"))&&(t.addClass("processing"),s.text(d("Processing","woo-product-feed-pro")+" (0%)"),n.attr("data-status","processing"),r.addClass("hidden"),c.removeClass("hidden"),o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_feed_action_refresh",id:e,nonce:f.adtObj.adtNonce},success:function(i){var l;i.success?(console.log("Starting feed status polling for single feed refresh"),b([e]),i.data&&i.data.executed_from==="ajax"&&m(i.data.feed_id,i.data.offset||0,i.data.batch_size||0)):(alert(d("Error: ","woo-product-feed-pro")+(((l=i.data)==null?void 0:l.message)||d("An unknown error occurred.","woo-product-feed-pro"))),t.removeClass("processing"),s.text(d("Ready","woo-product-feed-pro")),n.attr("data-status","ready"),r.removeClass("hidden"),c.addClass("hidden"))},error:function(){alert(d("A network error occurred. Please try again.","woo-product-feed-pro")),t.removeClass("processing"),s.text(d("Ready","woo-product-feed-pro")),n.attr("data-status","ready"),r.removeClass("hidden"),c.addClass("hidden")}})))});function m(a,t,e){console.log("Generating batch for feed ".concat(a,", offset: ").concat(t,", batch size: ").concat(e));const s=o('.adt-manage-feeds-table-row[data-feed-id="'.concat(a,'"]'));if(s.length){const n=s.find(".adt-manage-feeds-table-row-status-text"),r=s.find(".adt-manage-feeds-table-row-status-dot");s.addClass("processing"),n.text().includes(d("Processing","woo-product-feed-pro"))||n.text(d("Processing","woo-product-feed-pro")+" (0%)"),r.attr("data-status","processing")}o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_pfp_generate_product_feed",nonce:f.adtObj.adtNonce,feed_id:a,offset:t,batch_size:e},success:function(n){n.success&&n.data.status==="processing"?(p?console.log("Feed status polling already active, continuing with batch processing"):(console.log("Starting feed status polling for batch processing"),b([a])),m(n.data.feed_id,n.data.offset,n.data.batch_size)):n.success&&console.log("Feed ".concat(a," batch processing completed"))},error:function(n,r,c){console.error("Error generating feed batch: ".concat(c))}})}function b(a){w(),p=!0,y(a),h=window.setInterval(()=>{if(p){const t=C();t.length>0?y(t):(console.log("No more processing feeds found, stopping poll"),w())}else w()},1e3)}function C(){const a=[];return o(".adt-manage-feeds-table-row").each(function(){const t=o(this),e=t.data("feed-id"),s=t.hasClass("processing"),n=t.find(".adt-manage-feeds-table-row-status-dot"),r=n.attr("data-status")==="processing",u=t.find(".adt-manage-feeds-table-row-status-text").text().toLowerCase().includes("processing");if((s||r||u)&&e){a.push(e),s||t.addClass("processing"),r||n.attr("data-status","processing");const i=t.find(".adt-manage-feeds-action-refresh"),l=t.find(".adt-manage-feeds-action-cancel");i.hasClass("hidden")||i.addClass("hidden"),l.hasClass("hidden")&&l.removeClass("hidden")}}),console.log("Found processing feed IDs:",a),a}function w(){console.log("Stopping feed status polling"),h!==null&&(console.log("Clearing interval ID:",h),window.clearInterval(h),h=null),g!==null&&(console.log("Aborting active XHR request"),g.abort(),g=null),p=!1,console.log("Poll stopped, isRefreshRunning =",p)}function y(a){if(g===null){if(a.length===0){w();return}console.log("Checking status for feed IDs:",a),g=o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_get_feed_processing_status",nonce:f.adtObj.adtNonce,feed_ids:a},success:function(t){g=null,t.success&&t.data&&t.data.length>0?t.data.forEach(e=>{const s=o('.adt-manage-feeds-table-row[data-feed-id="'.concat(e.feed_id,'"]'));if(s.length){const n=s.find(".adt-manage-feeds-table-row-status-text"),r=s.find(".adt-manage-feeds-table-row-status-dot"),c=s.find(".adt-manage-feeds-action-refresh"),u=s.find(".adt-manage-feeds-action-cancel"),i=s.find(".adt-manage-feeds-table-row-last-updated div");i.length&&i.text(e.last_updated);const l=s.find(".adt-manage-feeds-table-row-url div");l.length&&e.feed_url_html&&(l.html(e.feed_url_html),l.find(".adt-manage-feeds-table-row-url-copy-button").on("click",function(){const x=o(this).closest(".adt-manage-feeds-table-row-url").find("input");if(x.length){const E=x.val();_(E,o(this))}})),e.status==="processing"&&e.proc_perc<100?(s.addClass("processing"),n.text(d("Processing","woo-product-feed-pro")+" (".concat(e.proc_perc,"%)")),r.attr("data-status","processing"),c.hasClass("hidden")||c.addClass("hidden"),u.hasClass("hidden")&&u.removeClass("hidden"),console.log("Feed ".concat(e.feed_id," still processing at ").concat(e.proc_perc,"%"))):(s.removeClass("processing"),n.text(e.status),r.attr("data-status",e.status.toLowerCase()),c.hasClass("hidden")&&c.removeClass("hidden"),u.hasClass("hidden")||u.addClass("hidden"),console.log("Feed ".concat(e.feed_id," completed with status: ").concat(e.status)))}}):console.log("No valid data in response or empty response")},error:function(t,e,s){g=null,console.error("Error checking feed status:",s)}})}}function P(){const a=C();a.length>0?(console.log("Found in-progress feeds on page load:",a),o(".adt-manage-feeds-table-row.processing").each(function(){const t=o(this).find(".adt-manage-feeds-action-refresh"),e=o(this).find(".adt-manage-feeds-action-cancel");t.hasClass("hidden")||t.addClass("hidden"),e.hasClass("hidden")&&e.removeClass("hidden")}),console.log("Starting initial feed status polling"),b(a),console.log("Checking for feeds that need batch processing"),o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_get_feed_processing_status",nonce:f.adtObj.adtNonce,feed_ids:a},success:function(t){t.success&&t.data&&t.data.length>0?t.data.forEach(e=>{e.status==="processing"&&e.executed_from==="ajax"&&(console.log("Resuming batch generation for feed ID ".concat(e.feed_id)),m(e.feed_id,e.offset,e.batch_size))}):console.log("No feeds need batch processing or no valid response data")},error:function(t,e,s){console.error("Error checking feed details:",s)}})):console.log("No in-progress feeds found on page load")}P(),o(".adt-manage-feeds-action-delete").on("click",function(a){a.preventDefault();const t=o(this).closest(".adt-manage-feeds-table-row").data("feed-id");t&&confirm(d("Are you sure you want to delete this feed? This action cannot be undone.","woo-product-feed-pro"))&&o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_feed_action_delete",id:t,nonce:f.adtObj.adtNonce},success:function(e){e.success?window.location.reload():alert(d("Error: ","woo-product-feed-pro")+(e.data.message||d("An unknown error occurred.","woo-product-feed-pro")))},error:function(){alert(d("A network error occurred. Please try again.","woo-product-feed-pro"))}})});function _(a,t){navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(a).then(()=>{v(t)}).catch(e=>{console.error("Failed to copy text: ",e),k(a,t)}):k(a,t)}function k(a,t){try{const e=document.createElement("input");e.value=a,document.body.appendChild(e),e.select(),e.setSelectionRange(0,99999);const s=document.execCommand("copy");document.body.removeChild(e),s?v(t):console.error("Failed to copy text with execCommand")}catch(e){console.error("Failed to copy text with fallback method: ",e)}}function v(a){const t=a.find(".adt-tooltip-content"),e=t.text();t.text(d("Copied!","woo-product-feed-pro")),setTimeout(()=>{t.text(e)},2e3)}o(".adt-manage-feeds-bulk-actions-select").on("change",function(){const a=o(this).val();if(a){const t=o(".adt-manage-feeds-table-row-checkbox input:checked").length;j(a,t),o(this).val("")}});function j(a,t){let e;if(a==="cancel"){const s=[];if(o(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const n=o(this).closest(".adt-manage-feeds-table-row"),r=n.data("feed-id"),c=n.hasClass("processing")||n.find(".adt-manage-feeds-table-row-status-dot").attr("data-status")==="processing";r&&c&&s.push(r)}),t=s.length,t===0){alert(d("No processing feeds selected. The cancel action only applies to feeds that are currently processing.","woo-product-feed-pro"));return}e=d("Are you sure you want to cancel processing ".concat(t," feed(s)?"),"woo-product-feed-pro")}else if(a==="refresh"){const s=[];if(o(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const n=o(this).closest(".adt-manage-feeds-table-row"),r=n.data("feed-id"),c=n.data("post-status")==="publish";r&&c&&s.push(r)}),t=s.length,t===0){alert(d("No active feeds selected. The refresh action only applies to feeds that are currently active.","woo-product-feed-pro"));return}e=d("Are you sure you want to refresh ".concat(t," feed(s)?"),"woo-product-feed-pro")}else switch(a){case"activate":e=d("Are you sure you want to activate ".concat(t," feed(s)?"),"woo-product-feed-pro");break;case"deactivate":e=d("Are you sure you want to deactivate ".concat(t," feed(s)?"),"woo-product-feed-pro");break;case"duplicate":e=d("Are you sure you want to duplicate ".concat(t," feed(s)?"),"woo-product-feed-pro");break;case"delete":e=d("Are you sure you want to delete ".concat(t," feed(s)? This action cannot be undone."),"woo-product-feed-pro");break;default:return}confirm(e)&&A(a)}function A(a){let t=[];if(o(".adt-manage-feeds-table-row-checkbox input:checked").each(function(){const e=o(this).closest(".adt-manage-feeds-table-row").data("feed-id");e&&t.push(e)}),a==="cancel"&&(t=t.filter(e=>{const s=o('.adt-manage-feeds-table-row[data-feed-id="'.concat(e,'"]'));return s.hasClass("processing")||s.find(".adt-manage-feeds-table-row-status-dot").attr("data-status")==="processing"}),t.length===0)){alert(d("No processing feeds selected. The cancel action only applies to feeds that are currently processing.","woo-product-feed-pro"));return}if(a==="refresh"&&(t=t.filter(e=>o('.adt-manage-feeds-table-row[data-feed-id="'.concat(e,'"]')).data("post-status")==="publish"),t.length===0)){alert(d("No active feeds selected. The refresh action only applies to feeds that are currently active.","woo-product-feed-pro"));return}t.length>0&&(console.log("Processing ".concat(a," for feed IDs:"),t),a==="refresh"&&t.forEach(e=>{const s=o('.adt-manage-feeds-table-row[data-feed-id="'.concat(e,'"]')),n=s.find(".adt-manage-feeds-table-row-status-text"),r=s.find(".adt-manage-feeds-table-row-status-dot"),c=s.find(".adt-manage-feeds-action-refresh"),u=s.find(".adt-manage-feeds-action-cancel");s.addClass("processing"),n.text(d("Processing","woo-product-feed-pro")+" (0%)"),r.attr("data-status","processing"),c.addClass("hidden"),u.removeClass("hidden")}),a==="cancel"&&t.forEach(e=>{o('.adt-manage-feeds-table-row[data-feed-id="'.concat(e,'"]')).find(".adt-manage-feeds-table-row-status-text").text(d("Cancelling...","woo-product-feed-pro"))}),o.ajax({url:f.ajaxurl,type:"POST",data:{action:"adt_process_bulk_feed_actions",feed_ids:t,bulk_action:a,nonce:f.adtObj.adtNonce},success:function(e){var s;if(e.success)if(a==="refresh")console.log("Starting feed status polling for refresh action"),b(t),e.data&&e.data.feeds&&e.data.feeds.length>0?(console.log("Received feeds for processing:",e.data.feeds),e.data.feeds.forEach(n=>{n.executed_from==="ajax"?(console.log("Starting batch generation for feed ID ".concat(n.feed_id)),m(n.feed_id,n.offset||0,n.batch_size||0)):console.log("Feed ID ".concat(n.feed_id," will be processed via cron"))})):console.warn("No feeds data returned in the response, continuing with status polling only");else if(a==="cancel"){if(t.forEach(n=>{const r=o('.adt-manage-feeds-table-row[data-feed-id="'.concat(n,'"]')),c=r.find(".adt-manage-feeds-table-row-status-text"),u=r.find(".adt-manage-feeds-table-row-status-dot"),i=r.find(".adt-manage-feeds-action-refresh"),l=r.find(".adt-manage-feeds-action-cancel");r.removeClass("processing"),c.text(d("Stopped","woo-product-feed-pro")),u.attr("data-status","stopped"),i.removeClass("hidden"),l.addClass("hidden")}),p){const n=C();n.length===0?(console.log("No more feeds are processing after cancel action, stopping poll"),w()):console.log("".concat(n.length," feeds still processing after cancel action, continuing poll"))}}else if(e.data&&e.data.pagination){const n=new URL(window.location.href),r=e.data.pagination;n.searchParams.set("page_num",r.current_page.toString()),n.searchParams.set("per_page",r.per_page.toString()),window.location.href=n.toString()}else window.location.href=window.location.href;else alert(d("Error: ","woo-product-feed-pro")+(((s=e.data)==null?void 0:s.message)||d("An unknown error occurred.","woo-product-feed-pro"))),(a==="refresh"||a==="cancel")&&t.forEach(n=>{const r=o('.adt-manage-feeds-table-row[data-feed-id="'.concat(n,'"]')),c=r.find(".adt-manage-feeds-table-row-status-text"),u=r.find(".adt-manage-feeds-table-row-status-dot"),i=r.find(".adt-manage-feeds-action-refresh"),l=r.find(".adt-manage-feeds-action-cancel");a==="refresh"&&(r.removeClass("processing"),c.text(d("Ready","woo-product-feed-pro")),u.attr("data-status","ready"),i.removeClass("hidden"),l.addClass("hidden"))})},error:function(){alert(d("A network error occurred. Please try again.","woo-product-feed-pro")),(a==="refresh"||a==="cancel")&&t.forEach(e=>{const s=o('.adt-manage-feeds-table-row[data-feed-id="'.concat(e,'"]')),n=s.find(".adt-manage-feeds-table-row-status-text"),r=s.find(".adt-manage-feeds-table-row-status-dot"),c=s.find(".adt-manage-feeds-action-refresh"),u=s.find(".adt-manage-feeds-action-cancel");a==="refresh"&&(s.removeClass("processing"),n.text(d("Ready","woo-product-feed-pro")),r.attr("data-status","ready"),c.removeClass("hidden"),u.addClass("hidden"))})}}))}function S(){const a=o(".adt-manage-feeds-table-row-checkbox input").length,t=o(".adt-manage-feeds-table-row-checkbox input:checked").length,e=o(".adt-manage-feeds-table-header-checkbox input");t===0?(e.prop("checked",!1),e.prop("indeterminate",!1)):t===a?(e.prop("checked",!0),e.prop("indeterminate",!1)):(e.prop("checked",!1),e.prop("indeterminate",!0))}})})(window,document,jQuery);export{F as __vite_legacy_guard};
